!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),r(n(1)),r(n(2)),r(n(4)),r(n(5)),r(n(10));var i=n(3),s=n(3);e.EventQueue=s.default,e.queue=function(){return i.default.global()},e.flushOnce=function(){i.default.global().flushOnce()},e.flush=function(t){void 0===t&&(t=10),i.default.global().flush(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.attach=function(t,e){return this._attach(t,e,!1)},t.prototype.once=function(t,e){return this._attach(t,e,!0)},t.prototype._attach=function(t,e,n){var r,i,s,o,a=this;if("function"==typeof t)i=t,o=function(){return a.detach(i)};else if(e||"function"!=typeof t.post){if("object"!=typeof t)throw new Error("Expect a function or object as first argument");if("function"!=typeof e)throw new Error("Expect a function as second argument");r=t,i=e,o=function(){return a.detach(r,i)}}else s=t,o=function(){return a.detach(s)};return this._listeners?this._listeners=this._listeners.slice():this._listeners=[],this._listeners.push({deleted:!1,boundTo:r,handler:i,event:s,once:n}),o},t.prototype.detach=function(){for(var t,e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];this._listeners&&0!==this._listeners.length&&(r.length>=1&&("function"==typeof r[0]?e=r[0]:1===r.length&&"function"==typeof r[0].post?n=r[0]:t=r[0]),r.length>=2&&(e=r[1]),this._listeners=this._listeners.filter((function(r){return void 0!==e&&r.handler!==e||void 0!==n&&r.event!==n||void 0!==t&&r.boundTo!==t||(r.deleted=!0,!1)})),0===this._listeners.length&&delete this._listeners)},t.prototype.post=function(t){throw new Error("abstract")},t.prototype.listenerCount=function(){return this._listeners?this._listeners.length:0},t.prototype._call=function(t,e){t.deleted||(t.once&&(t.deleted=!0,this._listeners=this._listeners.filter((function(e){return e!==t})),0===this._listeners.length&&delete this._listeners),t.event?t.event.post.apply(t.event,e):t.handler.apply("object"==typeof t.boundTo?t.boundTo:this,e))},t}();e.BaseEvent=r},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._recursion=0,e}return r(e,t),e.prototype.post=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this._listeners&&0!==this._listeners.length){if(this._recursion++,e.MAX_RECURSION_DEPTH>0&&this._recursion>e.MAX_RECURSION_DEPTH)throw new Error("event fired recursively");for(var r=this._listeners,i=0;i<r.length;++i){var s=r[i];this._call(s,t)}this._recursion--}},e.MAX_RECURSION_DEPTH=10,e}(n(1).BaseEvent);e.SyncEvent=i;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(){t.prototype.post.call(this,void 0)},e}(i);e.VoidSyncEvent=s;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},e}(i);e.ErrorSyncEvent=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=function(){function t(){this.evtFilled=new r.SyncEvent,this.evtDrained=new r.SyncEvent,this._queue=[],this._flushing=!1}return t.global=function(){return t._instance||t.resetGlobal(),t._instance},t.resetGlobal=function(){t._instance=new t},t.prototype.empty=function(){return 0===this._queue.length},t.prototype.add=function(t){this._queue.push(t),1!==this._queue.length||this._flushing||this.evtFilled.post(this)},t.prototype.flushOnce=function(){var t=0===this._queue.length,e=this._flushing;this._flushing=!0;try{var n=this._queue;this._queue=[];for(var r=0;r<n.length;++r)n[r]()}finally{this._flushing=e,t||e||0!==this._queue.length||this.evtDrained.post(this)}},t.prototype.flush=function(t){void 0===t&&(t=10);var e=0===this._queue.length,n=this._flushing;this._flushing=!0;try{for(var r=0;this._queue.length>0;){if("number"==typeof t&&r>=t)throw this._queue=[],new Error("unable to flush the queue due to recursively added event. Clearing queue now");this.flushOnce(),++r}}finally{this._flushing=n,e||n||0!==this._queue.length||this.evtDrained.post(this)}},t}();e.default=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),s=n(3),o=function(t){function e(e){var n=t.call(this)||this;n._queued=!1,n.options=e;var r=e||{};return"boolean"==typeof r.condensed?n._condensed=r.condensed:n._condensed=!1,"object"==typeof r.queue&&null!==r.queue&&(n._queue=r.queue),n}return r(e,t),e.prototype.post=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this._listeners&&0!==this._listeners.length){var r=this._queue?this._queue:s.default.global();if(this._condensed){if(this._queuedData=e,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,r.add((function(){t._queued=!1;for(var e=t._queuedData,n=t._queuedListeners,r=0;r<n.length;++r){var i=n[r];t._call(i,e)}}))}else{var i=this._listeners;r.add((function(){for(var n=0;n<i.length;++n){var r=i[n];t._call(r,e)}}))}}},e}(i.BaseEvent);e.QueuedEvent=o;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(){t.prototype.post.call(this,void 0)},e}(o);e.VoidQueuedEvent=a;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(e){if(!this._listeners||0===this._listeners.length)throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},e}(o);e.ErrorQueuedEvent=u},function(t,e,n){"use strict";(function(t){var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function n(t){var n=e.call(this)||this;n._queued=!1,n.options=t;var r=t||{};return"boolean"==typeof r.condensed?n._condensed=r.condensed:n._condensed=!1,n}return r(n,e),n.defaultScheduler=function(e){"undefined"!=typeof window?setTimeout(e,0):t(e)},n.setScheduler=function(t){n._scheduler=t},n.prototype.post=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(this._listeners&&0!==this._listeners.length)if(this._condensed){if(this._queuedData=e,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,n._scheduler((function(){t._queued=!1;for(var e=t._queuedData,n=t._queuedListeners,r=0;r<n.length;++r){var i=n[r];t._call(i,e)}}))}else{var i=this._listeners;n._scheduler((function(){for(var n=0;n<i.length;++n){var r=i[n];t._call(r,e)}}))}},n.prototype._call=function(t,r){t.event&&t.event instanceof n?t.event._postDirect(r):e.prototype._call.call(this,t,r)},n.prototype._postDirect=function(t){if(this._listeners&&0!==this._listeners.length)for(var e=this._listeners,n=0;n<e.length;++n){var r=e[n];this._call(r,t)}},n._scheduler=n.defaultScheduler,n}(n(1).BaseEvent);e.AsyncEvent=i;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(){t.prototype.post.call(this,void 0)},e}(i);e.VoidAsyncEvent=s;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},e}(i);e.ErrorAsyncEvent=o}).call(this,n(7).setImmediate)},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function s(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new s(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new s(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(8),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(6))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i=1,s={},o=!1,a=t.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(t);u=u&&u.setTimeout?u:t,"[object process]"==={}.toString.call(t.process)?function(){r=function(t){e.nextTick((function(){h(t)}))}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&h(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){h(t.data)},r=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;r=function(e){var n=a.createElement("script");n.onreadystatechange=function(){h(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function(){r=function(t){setTimeout(h,0,t)}}(),u.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var o={callback:t,args:e};return s[i]=o,r(i),i++},u.clearImmediate=c}function c(t){delete s[t]}function h(t){if(o)setTimeout(h,0,t);else{var e=s[t];if(e){o=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{c(t),o=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(6),n(9))},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&p())}function p(){if(!h){var t=a(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||h||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i,s=n(11),o=n(2),a=n(5),u=n(4);!function(t){t[t.Sync=0]="Sync",t[t.Async=1]="Async",t[t.Queued=2]="Queued"}(i=e.EventType||(e.EventType={}));var c=function(){function t(t){this._events=[],t&&t.monitorAttach&&(this.evtFirstAttached=new h,this.evtLastDetached=new h)}return t.prototype.attach=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=i.Sync;t.length>0&&"number"==typeof t[0]&&(n=t.shift());var r,s,o,a=this;return"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?r=t[0]:o=t[0],s=t[1]):(a=t[0],r=t[1],s=t[2]),this._attach(n,a,r,o,s,!1)},t.prototype.once=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=i.Sync;t.length>0&&"number"==typeof t[0]&&(n=t.shift());var r,s,o,a=this;return"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?r=t[0]:o=t[0],s=t[1]):(a=t[0],r=t[1],s=t[2]),this._attach(n,a,r,o,s,!0)},t.prototype._attach=function(t,e,n,r,c,h){var l,f,p=this,d=this.evtFirstAttached?this.listenerCount():0;switch(t){case i.Sync:for(var v=0,y=this._events;v<y.length;v++){(b=y[v])instanceof o.SyncEvent&&(l=b)}l||(l=new o.SyncEvent,this._events.push(l));break;case i.Async:for(var m=0,_=this._events;m<_.length;m++){(b=_[m])instanceof a.AsyncEvent&&s.shallowEquals(b.options,c)&&(l=b)}l||(l=new a.AsyncEvent(c),this._events.push(l));break;case i.Queued:for(var g=0,w=this._events;g<w.length;g++){var b;(b=w[g])instanceof u.QueuedEvent&&s.shallowEquals(b.options,c)&&(l=b)}l||(l=new u.QueuedEvent(c),this._events.push(l));break;default:throw new Error("unknown EventType")}return f=h?r?l.once(r):l.once(e,n):r?l.attach(r):l.attach(e,n),this.evtFirstAttached&&0===d&&this.evtFirstAttached.post(),function(){var t=p.evtLastDetached?p.listenerCount():0;f(),p.evtLastDetached&&t>0&&0===p.listenerCount()&&p.evtLastDetached.post()}},t.prototype.attachSync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.unshift(i.Sync),this.attach.apply(this,t)},t.prototype.onceSync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.unshift(i.Sync),this.once.apply(this,t)},t.prototype.attachAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.unshift(i.Async),this.attach.apply(this,t)},t.prototype.onceAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.unshift(i.Async),this.once.apply(this,t)},t.prototype.attachQueued=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.unshift(i.Queued),this.attach.apply(this,t)},t.prototype.onceQueued=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.unshift(i.Queued),this.once.apply(this,t)},t.prototype.detach=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this.evtLastDetached?this.listenerCount():0,r=0;r<this._events.length;++r)this._events[r].detach.apply(this._events[r],t);this.evtLastDetached&&n>0&&0===this.listenerCount()&&this.evtLastDetached.post()},t.prototype.post=function(t){for(var e=[],n=0;n<this._events.length;++n)e.push(this._events[n]);for(n=0;n<e.length;++n)e[n].post(t)},t.prototype.listenerCount=function(){for(var t=0,e=0;e<this._events.length;++e)t+=this._events[e].listenerCount();return t},t}();e.AnyEvent=c;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(){t.prototype.post.call(this,void 0)},e}(c);e.VoidAnyEvent=h;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},e}(c);e.ErrorAnyEvent=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shallowEquals=function(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;switch(typeof t){case"boolean":case"number":case"string":case"function":case"symbol":case"undefined":return!1;case"object":if(null===t||null===e)return!1;if(Array.isArray(t)||Array.isArray(e)){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var r=[],i=[];for(var s in t)t.hasOwnProperty(s)&&r.push(s);for(var o in e)e.hasOwnProperty(o)&&i.push(o);if(r.sort(),i.sort(),r.join(",")!==i.join(","))return!1;for(n=0;n<r.length;++n)if(t[r[n]]!==e[r[n]])return!1;return!0;default:return!1}}},function(t,e,n){"use strict";n.r(e);const r=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),s=Symbol("Comlink.releaseProxy"),o=new WeakSet,a=new Map([["proxy",{canHandle:t=>t&&t[r],serialize(t){const{port1:e,port2:n}=new MessageChannel;return u(t,e),[n,[n]]},deserialize:t=>(t.start(),function(t,e){return function t(e,n=[],r=function(){}){let o=!1;const a=new Proxy(r,{get(r,i){if(h(o),i===s)return()=>y(e,{type:5,path:n.map(t=>t.toString())}).then(()=>{c(e),o=!0});if("then"===i){if(0===n.length)return{then:()=>a};const t=y(e,{type:0,path:n.map(t=>t.toString())}).then(v);return t.then.bind(t)}return t(e,[...n,i])},set(t,r,i){h(o);const[s,a]=d(i);return y(e,{type:1,path:[...n,r].map(t=>t.toString()),value:s},a).then(v)},apply(r,s,a){h(o);const u=n[n.length-1];if(u===i)return y(e,{type:4}).then(v);if("bind"===u)return t(e,n.slice(0,-1));const[c,l]=f(a);return y(e,{type:2,path:n.map(t=>t.toString()),argumentList:c},l).then(v)},construct(t,r){h(o);const[i,s]=f(r);return y(e,{type:3,path:n.map(t=>t.toString()),argumentList:i},s).then(v)}});return a}(t,[],e)}(t))}],["throw",{canHandle:t=>o.has(t),serialize(t){const e=t instanceof Error;let n=t;return e&&(n={isError:e,message:t.message,stack:t.stack}),[n,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error,t);throw t}}]]);function u(t,e=self){e.addEventListener("message",(function n(i){if(!i||!i.data)return;const{id:s,type:a,path:h}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(v);let f;try{const e=h.slice(0,-1).reduce((t,e)=>t[e],t),n=h.reduce((t,e)=>t[e],t);switch(a){case 0:f=n;break;case 1:e[h.slice(-1)[0]]=v(i.data.value),f=!0;break;case 2:f=n.apply(e,l);break;case 3:f=function(t){return Object.assign(t,{[r]:!0})}(new n(...l));break;case 4:{const{port1:e,port2:n}=new MessageChannel;u(t,n),f=function(t,e){return p.set(t,e),t}(e,[e])}break;case 5:f=void 0}}catch(t){f=t,o.add(t)}Promise.resolve(f).catch(t=>(o.add(t),t)).then(t=>{const[r,i]=d(t);e.postMessage(Object.assign(Object.assign({},r),{id:s}),i),5===a&&(e.removeEventListener("message",n),c(e))})})),e.start&&e.start()}function c(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function h(t){if(t)throw new Error("Proxy has been released and is not useable")}function l(t){return Array.prototype.concat.apply([],t)}function f(t){const e=t.map(d);return[e.map(t=>t[0]),l(e.map(t=>t[1]))]}const p=new WeakMap;function d(t){for(const[e,n]of a)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:3,name:e,value:r},i]}return[{type:0,value:t},p.get(t)||[]]}function v(t){switch(t.type){case 3:return a.get(t.name).deserialize(t.value);case 0:return t.value}}function y(t,e,n){return new Promise(r=>{const i=function(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}();t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===i&&(t.removeEventListener("message",e),r(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:i},e),n)})}var m;!function(t){t.Init="Init",t.Resizing="Resizing",t.ResizingDone="ResizingDone",t.Terminate="Terminate",t.WorkerInit="WorkerInit"}(m||(m={}));var _=n(0);class g{constructor(){this.baseDisposeAbleFns=[()=>this.baseEventEmitter.detach()],this.baseEventEmitter=new _.AnyEvent,this.baseUtils={createEventEmitter:()=>{const t=new _.AnyEvent;return this.baseDisposeAbleFns.push(t.detach.bind(t)),t}},this.baseDispose=(...t)=>{Object(_.flush)(),this.baseEventEmitter.detach(),this.baseDisposeAbleFns.forEach(e=>e(...t)),this.baseDisposeAbleFns.length=0}}}g.global={event:new _.AnyEvent},g.baseUtils={getStandardEvent:({error:t,meta:e,payload:n,type:r})=>({error:t,meta:e||{},payload:n,type:r}),createGetStandardEvent:()=>t=>g.baseUtils.getStandardEvent(t)};class w extends g{constructor({canvas:t,setupListeners:e=!0,padding:n=0}){super(),this.isTerminating=!1,this.ctxWorker=self,this.isResizing=!1,this.canvas=t,this.padding=n,e&&this.ctxWorker.addEventListener("message",({data:t})=>{const e=2*this.padding;switch(t.type){case m.Resizing:if(!t.payload)break;this.canvas.height=t.payload.height-e,this.canvas.width=t.payload.width-e,this.isResizing||(this.isResizing=!0);break;case m.ResizingDone:this.isResizing&&(this.isResizing=!1);break;case m.Terminate:this.isTerminating=!0,this.baseDispose()}this.baseEventEmitter.post(t)})}}w.utilsWorkerBase={postMessage:{workerInit:()=>w.ctxWorker.postMessage({type:m.WorkerInit})}},w.ctxWorker=self,w.gettersWorkerBase={dataInit:()=>new Promise(t=>{const e=({data:n})=>{if(n.type===m.Init&&n.payload)return w.ctxWorker.removeEventListener("message",e),t(n.payload)};w.ctxWorker.addEventListener("message",e)})};class b extends w{constructor(t){super(t),this.baseUtilsCanvas2D={clear:()=>this.ctxCanvas2D.clearRect(0,0,this.canvas.width,this.canvas.height),draw:async()=>{if(this.baseGettersCanvas2D.shouldDraw())return this.draw()}},this.baseGettersCanvas2D={shouldDraw:()=>!this.isTerminating&&!this.isResizing};const{canvas:e}=t;this.canvas=e;const n=this.canvas.getContext("2d");if(!n)throw new Error("Failed to get ctxCanvas2D.");this.ctxCanvas2D=n,this.baseEventEmitter.attachAsync(({type:t})=>{switch(t){case m.Resizing:this.ctxCanvas2D.clearRect(0,0,this.canvas.width,this.canvas.height);break;case m.ResizingDone:this.draw();break;case m.Terminate:this.baseUtilsCanvas2D.clear()}})}init(){}draw(){}}b.baseUtilsCanvas2D={async initDraw({TheClass:t,TheClassOptions:e,onInit:n,shouldDraw:r=!0,shouldInit:i=!0}){const s=await t.gettersWorkerBase.dataInit(),o=new t({...s,...e});return n&&await n({instance:o}),b.utilsWorkerBase.postMessage.workerInit(),i&&await o.init(),r&&await o.baseUtilsCanvas2D.draw(),o}},n.d(e,"EEvents",(function(){return E})),n.d(e,"TheWorker",(function(){return D}));var E;e.default={};!function(t){t.MicrophoneDataFrequency="MicrophoneDataFrequency",t.MicrophoneDataTimeDomain="MicrophoneDataTimeDomain"}(E||(E={}));class D extends b{constructor(){super(...arguments),this.animationFrameQueue={},this.data={},this.eventEmitters={microphoneDataTimeDomain:this.baseUtils.createEventEmitter(),microphoneDataFrequency:this.baseUtils.createEventEmitter()},this.postMicrophoneDataFrequency=t=>this.eventEmitters.microphoneDataFrequency.post({type:E.MicrophoneDataFrequency,payload:t}),this.postMicrophoneDataTimeDomain=t=>this.eventEmitters.microphoneDataTimeDomain.post({type:E.MicrophoneDataTimeDomain,payload:t}),this.init=()=>{this.baseDisposeAbleFns.push(this.destroy),this.eventEmitters.microphoneDataTimeDomain.attachAsync(({payload:t})=>{t&&(this.data.microphoneDataTimeDomain=t.data,this.draw())}),this.eventEmitters.microphoneDataFrequency.attachAsync(({payload:t})=>{t&&(this.data.microphoneDataFrequency=t.data)})},this.draw=()=>{this.baseGettersCanvas2D.shouldDraw()?this.animationFrameQueue.all=requestAnimationFrame(this.drawAll):this.destroy()},this.drawAll=()=>{this.baseUtilsCanvas2D.clear(),this.drawTimeDomain(),this.drawFrequency()},this.drawTimeDomain=async()=>{if(!this.data.microphoneDataTimeDomain)return;this.ctxCanvas2D.lineWidth=2,this.ctxCanvas2D.strokeStyle="rgb(0, 0, 0)",this.ctxCanvas2D.beginPath();const t=1*this.canvas.width/this.data.microphoneDataTimeDomain.length;let e=0;for(let n=0;n<this.data.microphoneDataTimeDomain.length;n++){const r=130*this.data.microphoneDataTimeDomain[n],i=this.canvas.height/4+r;0===n?this.ctxCanvas2D.moveTo(e,i):this.ctxCanvas2D.lineTo(e,i),e+=t}this.ctxCanvas2D.stroke()},this.drawFrequency=()=>{if(!this.data.microphoneDataFrequency)return;const t=this.canvas.width/this.data.microphoneDataFrequency.length*2.5,e=360/this.data.microphoneDataFrequency.length*t;let n=0;for(let r=0;r<this.data.microphoneDataFrequency.length;r++){const i=2*(this.data.microphoneDataFrequency[r]+140);this.ctxCanvas2D.fillStyle=`hsla(${r*e}, 100%, 50%, 1)`,this.ctxCanvas2D.fillRect(n,this.canvas.height-i/2,t,i/2),n+=t+1}},this.destroy=()=>{void 0!==this.animationFrameQueue.all&&cancelAnimationFrame(this.animationFrameQueue.all)}}}(async()=>{await b.baseUtilsCanvas2D.initDraw({TheClass:D,shouldDraw:!1,onInit:({instance:t})=>{u(t)}})})()}]);